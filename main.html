<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.1/redux.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="bower_components/mxgraph/javascript/mxClient.min.js"></script>
    <style>
        #graph svg{
            height:63px !important;
        }
    </style>
</head>

<body>
    <div id="graph"></div>
    <div id="app"></div>
    <script>
        var graph = new mxGraph(document.querySelector('#graph'));
        new mxRubberband(graph);
        var parent = graph.getDefaultParent();
        graph.getModel().beginUpdate();
        try {
            var ventity1Vertax1 = graph.insertVertex(parent, null, 'Hello,', 20, 20, 80, 30);
            var ventity1Vertax2 = graph.insertVertex(parent, null, 'World!', 150, 20, 80, 30);
            var relationEdge = graph.insertEdge(parent, null, '', ventity1Vertax1, ventity1Vertax2);
        } finally {
            graph.getModel().endUpdate();
        }
        function left2right(entity1, entity2, relation) {
            return `
        <p>
            <input class="input" type="text" name="entity1" value=${entity1}>는
            <select>
                <option selected>하나</option>
                <option>여러개</option>
            </select>의
            <input class="input" type="text" name="entity2" value=${entity2}>에
            <input class="input" type="text" name="relation" value=${relation}>된다.
        </p>
        `;
        }

        function right2left(entity1, entity2, relation) {
            return `
        <p>
            <input class="input" type="text" name="entity2" value=${entity2}>는
            <select>
                <option selected>하나</option>
                <option>여러개</option>
            </select>의
            <input class="input" type="text" name="entity1" value=${entity1}>에
            <input class="input" type="text" name="relation" value=${relation}>된다.
        </p>
        `;
        }
        var initStore = {
            entity1: '댓글',
            entity2: '저자',
            relation: '소속'
        };
        var reducer = function (state, action) {
            if (action.type === 'init') {
                return initStore;
            }
            var newState = Object.assign({}, state);
            if (action.type === 'INPUT_CHANGE') {
                newState[action.name] = action.value;
            }
            return newState;
        }
        var store = Redux.createStore(reducer);
        store.subscribe(function () {
            var state = store.getState();
            console.log(state);
            document.querySelector('#app').innerHTML =
                left2right(state.entity1, state.entity2, state.relation) +
                right2left(state.entity1, state.entity2, state.relation);
            graph.model.setValue(ventity1Vertax1, state.entity1);
            graph.model.setValue(ventity1Vertax2, state.entity2);
        })
        store.dispatch({
            type: 'init'
        });
        $('body').on('change', '.input', function (event) {
            store.dispatch({
                type: 'INPUT_CHANGE',
                name: event.target.name,
                value: event.target.value
            })
        })
        
    </script>
</body>

</html>